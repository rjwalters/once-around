<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>Once Around the Night Sky</title>
  </head>
  <body>
    <div id="app"></div>

    <button id="mobile-panel-toggle" class="mobile-panel-toggle" aria-label="Toggle controls">‚ò∞</button>

    <div id="controls">
      <div class="view-mode-section">
        <span class="view-mode-label">View Mode</span>
        <div class="view-mode-toggle">
          <button id="view-geocentric" class="view-mode-btn active">
            <span class="mode-icon">&#x1F310;</span>
            <span>Geocentric</span>
          </button>
          <button id="view-topocentric" class="view-mode-btn">
            <span class="mode-icon">&#x25D1;</span>
            <span>Topocentric</span>
          </button>
        </div>
      </div>

      <div class="control-group">
        <label>Date & Time (UTC)</label>
        <input type="datetime-local" id="datetime" />
        <div class="time-step-controls">
          <button id="time-now" class="time-step-btn time-now-btn" title="Jump to current time (N)">‚äô</button>
          <button id="time-back" class="time-step-btn" title="Step backward (‚Üê)">|‚óÄ</button>
          <button id="time-play" class="time-step-btn time-play-btn" title="Play/Pause (P)">‚ñ∂</button>
          <button id="time-step-unit" class="time-step-unit" title="Click to change step size">1h</button>
          <button id="time-forward" class="time-step-btn" title="Step forward (‚Üí)">‚ñ∂|</button>
        </div>
      </div>

      <div class="control-group search-group">
        <label>Search <span class="shortcut">(/)</span></label>
        <input type="text" id="search" placeholder="Planet, star, constellation..." autocomplete="off" />
        <div id="search-results" class="search-results"></div>
      </div>

      <div class="control-group">
        <label>Limiting Magnitude: <span id="mag-value">6.5</span></label>
        <input type="range" id="magnitude" min="-1" max="12" step="0.5" value="6.5" />
        <div class="mag-hint" id="mag-hint">Dark sky (naked eye limit)</div>
      </div>

      <div class="control-group checkbox-group">
        <label>
          <input type="checkbox" id="constellations" />
          Show constellations <span class="shortcut">(C)</span>
        </label>
      </div>

      <div class="control-group checkbox-group">
        <label>
          <input type="checkbox" id="labels" />
          Show labels <span class="shortcut">(L)</span>
        </label>
      </div>

      <div class="control-group checkbox-group">
        <label>
          <input type="checkbox" id="videos" checked />
          Show videos (107) <span class="shortcut">(V)</span>
        </label>
      </div>

      <div class="control-group checkbox-group">
        <label>
          <input type="checkbox" id="orbits" />
          Show orbits <span class="shortcut">(O)</span>
        </label>
      </div>

      <div class="control-group checkbox-group">
        <label>
          <input type="checkbox" id="dsos" />
          Show deep sky objects <span class="shortcut">(D)</span>
        </label>
      </div>

      <div class="control-group checkbox-group">
        <label>
          <input type="checkbox" id="night-vision" />
          Night vision mode <span class="shortcut">(R)</span>
        </label>
      </div>

      <div class="control-group checkbox-group">
        <label>
          <input type="checkbox" id="horizon" />
          Show horizon/ground <span class="shortcut">(H)</span>
        </label>
      </div>

      <div id="seeing-control" class="control-group seeing-control" style="display: none;">
        <label for="seeing-select">Atmospheric seeing</label>
        <select id="seeing-select">
          <option value="0">None (space view)</option>
          <option value="0.4">Excellent</option>
          <option value="0.7" selected>Average</option>
          <option value="1.0">Poor (turbulent)</option>
        </select>
      </div>

      <button id="ar-mode-btn" class="ar-mode-btn" aria-pressed="false" title="Point your phone at the sky">
        <span class="ar-mode-icon">üì±</span>
        <span>AR Mode</span>
      </button>

      <div id="location-section" class="location-section">
        <div class="location-section-header">
          <span class="icon">&#x1F4CD;</span>
          <span>Observer Location</span>
        </div>
        <div class="location-search-group">
          <input type="text" id="location-search" placeholder="Search cities..." autocomplete="off" />
          <div id="location-results" class="location-results"></div>
        </div>
        <div class="location-coords">
          <div class="location-coord-input">
            <label>Latitude</label>
            <input type="number" id="location-lat" step="0.0001" min="-90" max="90" />
          </div>
          <div class="location-coord-input">
            <label>Longitude</label>
            <input type="number" id="location-lon" step="0.0001" min="-180" max="180" />
          </div>
        </div>
        <div class="location-actions">
          <button id="location-geolocate" class="location-btn" title="Use device GPS">
            <span>üìç</span> My Location
          </button>
        </div>
        <div class="location-current">
          <div class="location-current-name" id="location-name">San Francisco, USA</div>
        </div>
        <div class="location-lst" id="location-lst-container" style="display: none;">
          <span class="lst-label">Local Sidereal Time:</span>
          <span class="lst-value" id="location-lst">--h --m</span>
        </div>
      </div>

      <div class="tour-section">
        <div class="tour-header">
          <span class="tour-label">Guided Tours</span>
          <span class="tour-count" id="tour-count"></span>
        </div>
        <div class="tour-list" id="tour-list">
          <!-- Tour items generated dynamically from tourData.ts -->
        </div>
      </div>

      <button class="about-button" id="about-btn">About This Project</button>
    </div>

    <!-- Star Info Modal -->
    <div class="star-modal hidden" id="star-modal">
      <div class="star-modal-content">
        <button class="star-modal-close" id="star-modal-close">&times;</button>
        <div class="star-modal-header">
          <h2 class="star-modal-name" id="star-modal-name">Sirius</h2>
          <div class="star-modal-designation" id="star-modal-designation">Alpha Canis Majoris</div>
        </div>
        <div class="star-modal-stats">
          <div class="star-stat">
            <span class="star-stat-label">Constellation</span>
            <span class="star-stat-value" id="star-modal-constellation">Canis Major</span>
          </div>
          <div class="star-stat">
            <span class="star-stat-label">Magnitude</span>
            <span class="star-stat-value" id="star-modal-magnitude">-1.46</span>
          </div>
          <div class="star-stat">
            <span class="star-stat-label">Distance</span>
            <span class="star-stat-value" id="star-modal-distance">8.6 light-years</span>
          </div>
        </div>
        <div class="star-modal-type" id="star-modal-type">A1V - White main-sequence star</div>
        <p class="star-modal-description" id="star-modal-description">
          The brightest star in the night sky.
        </p>
      </div>
    </div>

    <!-- Constellation Info Modal -->
    <div class="constellation-modal hidden" id="constellation-modal">
      <div class="constellation-modal-content">
        <button class="constellation-modal-close" id="constellation-modal-close">&times;</button>
        <div class="constellation-modal-header">
          <h2 class="constellation-modal-name" id="constellation-modal-name">Orion</h2>
          <div class="constellation-modal-subtitle">
            <span class="abbr" id="constellation-modal-abbr">Ori</span> &bull;
            <span id="constellation-modal-meaning">The Hunter</span>
          </div>
        </div>
        <div class="constellation-modal-stats">
          <div class="constellation-stat">
            <span class="constellation-stat-label">Brightest Star</span>
            <span class="constellation-stat-value" id="constellation-modal-star">Rigel</span>
          </div>
          <div class="constellation-stat">
            <span class="constellation-stat-label">Area</span>
            <span class="constellation-stat-value" id="constellation-modal-area">594 sq¬∞</span>
          </div>
          <div class="constellation-stat">
            <span class="constellation-stat-label">Best Viewing</span>
            <span class="constellation-stat-value" id="constellation-modal-viewing">January</span>
          </div>
          <div class="constellation-stat">
            <span class="constellation-stat-label">Quadrant</span>
            <span class="constellation-stat-value" id="constellation-modal-quadrant">NQ1</span>
          </div>
        </div>
        <div class="constellation-modal-objects" id="constellation-modal-objects-container">
          <span class="constellation-modal-objects-label">Notable Objects</span>
          <span id="constellation-modal-objects">M42 Orion Nebula, Horsehead Nebula</span>
        </div>
        <p class="constellation-modal-description" id="constellation-modal-description">
          One of the most recognizable constellations in the sky.
        </p>
      </div>
    </div>

    <!-- DSO Info Modal -->
    <div class="dso-modal hidden" id="dso-modal">
      <div class="dso-modal-content">
        <button class="dso-modal-close" id="dso-modal-close">&times;</button>
        <div class="dso-modal-header">
          <h2 class="dso-modal-name" id="dso-modal-name">M31</h2>
          <div class="dso-modal-subtitle">
            <span id="dso-modal-common-name">Andromeda Galaxy</span>
            <span class="dso-modal-type-badge" id="dso-modal-type-badge">Galaxy</span>
          </div>
        </div>
        <div class="dso-modal-stats">
          <div class="dso-stat">
            <span class="dso-stat-label">Magnitude</span>
            <span class="dso-stat-value" id="dso-modal-magnitude">3.4</span>
          </div>
          <div class="dso-stat">
            <span class="dso-stat-label">Angular Size</span>
            <span class="dso-stat-value" id="dso-modal-size">190' √ó 60'</span>
          </div>
          <div class="dso-stat">
            <span class="dso-stat-label">Distance</span>
            <span class="dso-stat-value" id="dso-modal-distance">2.5 million light-years</span>
          </div>
          <div class="dso-stat">
            <span class="dso-stat-label">Coordinates</span>
            <span class="dso-stat-value" id="dso-modal-coords">RA 0h 42m, Dec +41¬∞</span>
          </div>
        </div>
        <p class="dso-modal-description" id="dso-modal-description">
          The nearest major galaxy to the Milky Way.
        </p>
      </div>
    </div>

    <!-- Comet Info Modal -->
    <div class="comet-modal hidden" id="comet-modal">
      <div class="comet-modal-content">
        <button class="comet-modal-close" id="comet-modal-close">&times;</button>
        <div class="comet-modal-header">
          <h2 class="comet-modal-name" id="comet-modal-name">1P/Halley</h2>
          <div class="comet-modal-subtitle">
            <span id="comet-modal-common-name">Halley's Comet</span>
            <span class="comet-modal-type-badge" id="comet-modal-type-badge">Periodic</span>
          </div>
        </div>
        <div class="comet-modal-stats">
          <div class="comet-stat">
            <span class="comet-stat-label">Orbital Period</span>
            <span class="comet-stat-value" id="comet-modal-period">~76 years</span>
          </div>
          <div class="comet-stat">
            <span class="comet-stat-label">Perihelion Distance</span>
            <span class="comet-stat-value" id="comet-modal-perihelion">0.59 AU</span>
          </div>
          <div class="comet-stat">
            <span class="comet-stat-label">Last Perihelion</span>
            <span class="comet-stat-value" id="comet-modal-last-visit">Feb 9, 1986</span>
          </div>
          <div class="comet-stat">
            <span class="comet-stat-label">Next Return</span>
            <span class="comet-stat-value" id="comet-modal-next-return">Jul 28, 2061</span>
          </div>
        </div>
        <p class="comet-modal-description" id="comet-modal-description">
          The most famous comet in history.
        </p>
      </div>
    </div>

    <!-- About Modal -->
    <div class="about-modal hidden" id="about-modal">
      <div class="about-content">
        <button class="about-close" id="about-close">&times;</button>
        <h2 class="about-title">Once Around the Night Sky</h2>

        <div class="about-section">
          <h3>About</h3>
          <p>
            An interactive visualizer for
            <a href="https://www.youtube.com/@oncearound" target="_blank" rel="noopener">Paul Fellows'</a>
            excellent "Once Around" series of astronomy YouTube videos.
            Explore the night sky and discover the celestial objects featured in the series.
          </p>
        </div>

        <div class="about-section">
          <h3>Data Sources</h3>
          <ul>
            <li><strong>Stars:</strong> Hipparcos Catalogue (~118,000 stars) with fallback to Yale Bright Star Catalog</li>
            <li><strong>Planets:</strong> VSOP87 planetary theory for high-precision positions</li>
            <li><strong>Moon:</strong> Simplified lunar ephemeris based on Meeus's Astronomical Algorithms</li>
            <li><strong>Constellations:</strong> IAU constellation boundaries with stick figures</li>
          </ul>
        </div>

        <div class="about-section">
          <h3>Links</h3>
          <p>
            <a href="https://www.youtube.com/@oncearound" target="_blank" rel="noopener">Once Around YouTube Channel</a><br>
            <a href="https://github.com/rjwalters/once-around" target="_blank" rel="noopener">GitHub Repository</a>
          </p>
        </div>

        <div class="about-footer">
          Built with Three.js and Rust/WebAssembly<br>
          <span id="build-info" class="build-info"></span>
        </div>
      </div>
    </div>

    <div id="info">Drag to look around | Scroll to zoom | Press <kbd>?</kbd> for keyboard shortcuts</div>

    <!-- Keyboard Shortcuts Help Modal -->
    <div class="help-modal hidden" id="help-modal">
      <div class="help-modal-content">
        <button class="help-modal-close" id="help-modal-close">&times;</button>
        <h2 class="help-modal-title">Keyboard Shortcuts</h2>

        <div class="help-section">
          <h3>View Controls</h3>
          <div class="help-shortcuts">
            <div class="help-shortcut"><kbd>L</kbd><span>Toggle labels</span></div>
            <div class="help-shortcut"><kbd>C</kbd><span>Toggle constellations</span></div>
            <div class="help-shortcut"><kbd>V</kbd><span>Toggle videos</span></div>
            <div class="help-shortcut"><kbd>O</kbd><span>Toggle orbits</span></div>
            <div class="help-shortcut"><kbd>D</kbd><span>Toggle deep sky objects</span></div>
            <div class="help-shortcut"><kbd>H</kbd><span>Toggle horizon/ground</span></div>
            <div class="help-shortcut"><kbd>R</kbd><span>Night vision mode</span></div>
          </div>
        </div>

        <div class="help-section">
          <h3>Time & Navigation</h3>
          <div class="help-shortcuts">
            <div class="help-shortcut"><kbd>N</kbd><span>Jump to current time</span></div>
            <div class="help-shortcut"><kbd>P</kbd><span>Play/pause time</span></div>
            <div class="help-shortcut"><kbd>‚Üê</kbd><span>Step time backward</span></div>
            <div class="help-shortcut"><kbd>‚Üí</kbd><span>Step time forward</span></div>
            <div class="help-shortcut"><kbd>E</kbd><span>Next total eclipse</span></div>
            <div class="help-shortcut"><kbd>Space</kbd><span>Go to galactic center</span></div>
          </div>
        </div>

        <div class="help-section">
          <h3>Other</h3>
          <div class="help-shortcuts">
            <div class="help-shortcut"><kbd>/</kbd><span>Focus search</span></div>
            <div class="help-shortcut"><kbd>Esc</kbd><span>Stop tour / close modal</span></div>
            <div class="help-shortcut"><kbd>?</kbd><span>Show this help</span></div>
          </div>
        </div>

        <div class="help-section">
          <h3>Mouse & Touch</h3>
          <div class="help-shortcuts">
            <div class="help-shortcut"><span class="help-action">Drag</span><span>Look around</span></div>
            <div class="help-shortcut"><span class="help-action">Scroll</span><span>Zoom in/out</span></div>
            <div class="help-shortcut"><span class="help-action">Click</span><span>Select object</span></div>
          </div>
        </div>
      </div>
    </div>

    <div id="ar-mode-status" class="ar-mode-status"></div>

    <div id="eclipse-banner" class="eclipse-banner hidden">
      <div class="eclipse-banner-icon">‚òÄ</div>
      <div class="eclipse-banner-content">
        <div class="eclipse-banner-title">Total Solar Eclipse</div>
        <div class="eclipse-banner-details">
          <span id="eclipse-banner-date"></span> &bull;
          <span id="eclipse-banner-path"></span> &bull;
          Duration: <span id="eclipse-banner-duration"></span>s
        </div>
      </div>
      <div class="eclipse-banner-separation">
        Sun-Moon: <span id="eclipse-banner-sep">--</span>¬∞
      </div>
    </div>

    <!-- Tour Playback Bar -->
    <div id="tour-playback" class="tour-playback hidden">
      <div class="tour-playback-header">
        <span id="tour-playback-name" class="tour-playback-name">Tour Name</span>
        <div class="tour-playback-controls">
          <button id="tour-prev" class="tour-control-btn" title="Previous">‚èÆ</button>
          <button id="tour-play-pause" class="tour-control-btn" title="Play/Pause">‚è∏</button>
          <button id="tour-next" class="tour-control-btn" title="Next">‚è≠</button>
          <button id="tour-stop" class="tour-control-btn stop-btn" title="Stop (Esc)">‚úï</button>
        </div>
      </div>
      <div class="tour-progress-bar">
        <div id="tour-progress" class="tour-progress-fill"></div>
      </div>
      <div id="tour-caption" class="tour-caption"></div>
    </div>

    <div id="crosshair"></div>
    <div id="reference-circle" title="50 arcsec reference circle"></div>

    <div id="coordinates">
      <span id="coord-altaz-group" style="display: none;">
        <span class="label">Alt</span><span id="coord-alt" class="value">+0¬∞</span>
        &nbsp;
        <span class="label">Az</span><span id="coord-az" class="value">0¬∞ (N)</span>
        &nbsp;
      </span>
      <span id="coord-radec-group">
        <span class="label">RA</span><span id="coord-ra" class="value">0h 0m</span>
        &nbsp;
        <span class="label">Dec</span><span id="coord-dec" class="value">+0¬∞ 0'</span>
      </span>
      &nbsp;
      <span class="label">FOV</span><span id="coord-fov" class="value">60¬∞</span>
    </div>

    <!-- Debug panel: add ?debug to URL to show -->
    <div id="debug" style="display: none;">
      <div>View: Œ∏=<span id="dbg-theta">0</span>¬∞ œÜ=<span id="dbg-phi">0</span>¬∞</div>
      <div>Mouse down: (<span id="dbg-start-x">-</span>, <span id="dbg-start-y">-</span>)</div>
      <div>Mouse delta: (<span id="dbg-dx">-</span>, <span id="dbg-dy">-</span>)</div>
      <div>Angular Œî: Œ∏=<span id="dbg-dtheta">-</span>¬∞ œÜ=<span id="dbg-dphi">-</span>¬∞</div>
      <div>FOV: <span id="dbg-fov">60</span>¬∞</div>
    </div>
    <script>
      if (window.location.search.includes('debug')) {
        document.getElementById('debug').style.display = 'block';
      }

      // Mobile panel toggle
      const mobileToggle = document.getElementById('mobile-panel-toggle');
      const controlsPanel = document.getElementById('controls');
      if (mobileToggle && controlsPanel) {
        mobileToggle.addEventListener('click', () => {
          const isExpanded = controlsPanel.classList.toggle('expanded');
          mobileToggle.classList.toggle('active', isExpanded);
          mobileToggle.textContent = isExpanded ? '‚úï' : '‚ò∞';
        });
      }
    </script>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
